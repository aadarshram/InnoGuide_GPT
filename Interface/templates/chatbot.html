{% extends 'base.html' %} {% block content %}
<div class="mask" style="background-color: hsla(0, 0%, 0%, 0.3)">
  <div
    class="container d-flex justify-content-center align-items-center min-vh-100"
  >
    <div class="chat-container text-center" id="chat-container">
      <div
        class="chat-prompt d-flex align-items-center mb-4 justify-content-center"
      >
        <div
          id="typewriter"
          class="me-4 ms-2"
          style="font-size: 40px; color: #0e0f0f"
        ></div>
      </div>

      <!-- Chat Footer with Input -->
      <form id="messageArea" class="input-group mb-3">
        <input
          type="text"
          id="text"
          name="msg"
          placeholder="Type your message or click the mic for voice"
          autocomplete="on"
          class="form-control form-control-lg"
          required
          style="font-size: 24px"
        />
        <div class="input-group-append d-flex align-items-center">
          <button
            type="button"
            id="mic"
            class="btn btn-secondary rounded-circle me-2"
            title="Voice Input"
            style="width: 70px; height: 70px"
          >
            <i class="fas fa-microphone text-white fa-lg"></i>
          </button>
          <button
            type="submit"
            id="send"
            class="btn btn-primary rounded-circle"
            title="Send Message"
            style="width: 70px; height: 70px"
          >
            <i class="fas fa-paper-plane fa-lg"></i>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // Typewriting effect function for the prompt
  const typewriterText = "What's on your mind?";
  const typewriterElement = document.getElementById("typewriter");
  let index = 0;

  function typeWriter() {
    if (index < typewriterText.length) {
      typewriterElement.innerHTML += typewriterText.charAt(index);
      index++;
      setTimeout(typeWriter, 100); // Adjust typing speed (100 ms)
    }
  }

  // Start typewriter effect for the prompt
  typeWriter();

  // Function to clear the typewriter text
  function clearTypewriter() {
    typewriterElement.innerHTML = ""; // Clear the typewriter text
  }

  // Typewriting effect function for chatbot response
  function typeWriterResponse(text, element) {
    let responseIndex = 0;

    function writeResponse() {
      if (responseIndex < text.length) {
        element.innerHTML += text.charAt(responseIndex);
        responseIndex++;
        setTimeout(writeResponse, 50); // Adjust typing speed for chatbot response
      }
    }

    writeResponse();
  }

  // Event listener for form submission
  $("#messageArea").on("submit", function (event) {
    event.preventDefault(); // Prevent the form from submitting

    // Clear the typewriter text on first submission
    if (index > 0) {
      clearTypewriter();
    }

    // Move the input field down smoothly
    $("#messageArea").animate(
      {
        marginTop: "600px", // Adjust this value for positioning
      },
      1000
    );

    // Get the user's input and clear the field
    const userMessage = $("#text").val();
    $("#text").val(""); // Clear the input field after submission

    // Remove previous response if it exists
    $(".chat-response").remove();

    // Create new response element
    const chatbotResponse = $(
      '<div id="chatbotResponse" class="chat-response"></div>'
    );
    $("#chat-container").prepend(chatbotResponse);

    // Send the user's message to the Flask server
    fetch("/get", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: new URLSearchParams({ msg: userMessage }),
    })
      .then((response) => {
        const reader = response.body.getReader();
        const decoder = new TextDecoder("utf-8");
        let done = false;

        // Read the stream
        const readStream = async () => {
          while (!done) {
            const { done: streamDone, value } = await reader.read();
            done = streamDone;
            if (value) {
              const text = decoder.decode(value, { stream: true });
              // Use the typewriter effect to display the streamed chatbot response
              typeWriterResponse(
                text,
                document.getElementById("chatbotResponse")
              );
            }
          }
        };

        readStream();
      })
      .catch((error) => {
        // Handle any errors that occur during the request
        const errorText = "Sorry, something went wrong.";
        typeWriterResponse(
          errorText,
          document.getElementById("chatbotResponse")
        );
      });
  });
</script>
<style>
  .video-background {
    position: relative;
    height: 100vh; /* Full viewport height */
    overflow: hidden; /* Hide overflow */
  }

  .video-background video {
    position: absolute; /* Correct positioning */
    top: 50%;
    left: 50%;
    min-width: 100%; /* Ensures the video covers the whole background */
    min-height: 100%;
    width: auto;
    height: auto;
    z-index: 1; /* Behind content */
    transform: translate(-50%, -50%); /* Center the video */
  }

  .mask {
    position: absolute; /* Positioning for the mask */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 2; /* Ensures mask is above video */
  }

  /* Container for chat prompt and input area */
  .chat-container {
    width: 100%; /* Full width */
    border-radius: 25px; /* Rounded edges */
    padding: 20px; /* Add padding for better spacing */
    background-color: rgba(
      255,
      255,
      255,
      0.9
    ); /* Light background for contrast */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    position: relative; /* Important for positioning the chatbot response */
  }

  /* Button styles */
  .btn-secondary {
    background-color: #cc3608;
    border: none;
    transition: background-color 0.3s ease;
  }

  .btn-secondary:hover {
    background-color: #d95a3a; /* Lighter shade on hover */
  }

  .btn-primary {
    background-color: #007bff;
    border: none;
    transition: background-color 0.3s ease;
  }

  .btn-primary:hover {
    background-color: #0056b3; /* Darker shade on hover */
  }

  /* Input field styles */
  #text {
    transition: border-color 0.3s ease;
    border-radius: 25px; /* Rounded edges */
  }

  #text:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  }

  /* Chatbot response style */
  .chat-response {
    font-size: 25px;
    color: #333;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 10px;
    text-align: center;
  }
</style>

{% endblock %}
